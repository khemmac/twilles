
Ext.define('BASE.Action',{extend:'Ext.Action',constructor:function(config){return this.callParent(arguments);},initComponent:function(){return this.callParent(arguments);},validateSingle:function(source){var s=source.getSelectionsId();if(Ext.isArray(s))
this[(s.length==1)?"enable":"disable"]();else
this[(s!=null)?"enable":"disable"]();},validateMultiple:function(source){var s=source.getSelectionsId();if(Ext.isArray(s))
this[(s.length>0)?"enable":"disable"]();else
this[(s!=null)?"enable":"disable"]();}});;Ext.define('BASE.ux.FormStatus',{extend:'Ext.AbstractPlugin',moduleType:null,init:function(form){var me=this;me.moduleType.length;form=Ext.apply(form,{getSetStatusParams:function(){return Ext.apply({type:me.moduleType},this.formParams);},getSetStatusUrl:function(){return __site_url+'backend/istatus/set';},setStatus:function(){var _this=this;var url=form.getSetStatusUrl();_this.form.load({url:url,clientValidation:true,success:function(form,act){_this.fireEvent('afterSetStatus',_this,act);},failure:_this.failureAlert,waitMsg:'Changing status...',waitTitle:'Please wait...',params:_this.getSetStatusParams()});}});},});;Ext.define('BASE.Grid',{extend:'Ext.grid.Panel',constructor:function(config){config=Ext.apply(config,{loadMask:true});Ext.apply(this,config);return this.callParent(arguments);},initComponent:function(){var _this=this;if(!this.selModel)
this.selModel=new Ext.selection.CheckboxModel();if(!this.store)
this.store=new Ext.data.JsonStore({proxy:{type:'ajax',url:__site_url+"dummy/loads",reader:{type:'json',root:'rows',totalProperty:'totalCount',idProperty:'id'},simpleSortMode:true},fields:['id','name'],remoteSort:true,sorters:[{property:'id',direction:'ASC'}],pageSize:25});if(!this.columns)
this.columns=[this.selModel,{text:"Id",width:90,dataIndex:'id',sortable:true},{text:"Name",width:80,dataIndex:'name',sortable:true,align:'center'}];if(!this.bbar&&!this.disablePaging)
this.bbar={xtype:'pagingtoolbar',store:this.store,displayInfo:true};this.addEvents('selectionchange','afterLoad');this.selModel.on('selectionchange',function(sm){this.validate();this.fireEvent('selectionchange',this,sm);},this);return this.callParent(arguments);},getSelectionsObject:function(){var rs=[],sm=this.getView().getSelectionModel(),rs=sm.getSelection();return rs;},getSelectionsId:function(){var rs=this.getSelectionsObject(),ids=[],rId=this.store.getProxy().getReader().idProperty;Ext.each(rs,function(o,i,a){ids.push(o.get(rId));});return ids;},getSelectedId:function(){var ids=this.getSelectionsId();return Ext.isArray(ids)?ids[0]:ids;},getSelectedObject:function(){var sm=this.selModel;var rs=sm.getSelections();var ids=[];Ext.each(rs,function(o,i,a){ids.push(o);});return ids[0];},load:function(arg){var ds=this.store;var baseParam={};var ids=this.getSelectionsId();var _this=this;baseParam={params:arg,callback:function(){_this.validate();_this.fireEvent('afterLoad',_this,ids);}};ds.load(baseParam);},reload:function(){alert('do reload');var ds=this.store;var ids=this.getSelectionsId();var _this=this;ds.reload({callback:function(){_this.validate();_this.fireEvent('afterLoad',_this,ids);},params:{}});},validateActions:[],validate:function(){Ext.each(this.validateActions,function(o,i,a){if(typeof(o.validate)=="function")
o.validate(this);},this);}});;Ext.define('BASE.ComboAjax',{extend:'Ext.form.field.ComboBox',editable:false,allowBlank:false,triggerAction:'all',emptyText:'-- Select --',queryMode:'remote',displayField:'name',valueField:'id',labelWidth:100,labelAlign:'right',width:300,proxyUrl:null,proxyExtraParams:null,proxyIdProperty:null,proxyFields:null,proxySorters:null,constructor:function(config){return this.callParent(arguments);},initComponent:function(){if(!this.store)
this.store=new Ext.data.JsonStore({proxy:{type:'ajax',url:this.proxyUrl||__site_url+'backend/dao/loadlist',reader:{type:'json',root:'rows',idProperty:this.proxyIdProperty||'id'},simpleSortMode:true,extraParams:this.proxyExtraParams},fields:this.proxyFields||['id','name'],remoteSort:true,sorters:this.proxySorters||[{property:'id',direction:'ASC'}],});return this.callParent(arguments);}});;Ext.define('BASE.field.NumericField',{extend:'Ext.form.field.Number',currencySymbol:null,currencySymbolPos:'right',useThousandSeparator:true,thousandSeparator:',',alwaysDisplayDecimals:false,fieldStyle:'text-align: right;',initComponent:function(){if(this.useThousandSeparator&&this.decimalSeparator==','&&this.thousandSeparator==',')
this.thousandSeparator='.';else
if(this.allowDecimals&&this.thousandSeparator=='.'&&this.decimalSeparator=='.')
this.decimalSeparator=',';this.callParent(arguments);},setValue:function(value){Ext.ux.form.NumericField.superclass.setValue.call(this,value!=null?value.toString().replace('.',this.decimalSeparator):value);this.setRawValue(this.getFormattedValue(this.getValue()));},getFormattedValue:function(value){if(Ext.isEmpty(value)||!this.hasFormat())
return value;else
{var neg=null;value=(neg=value<0)?value*-1:value;value=this.allowDecimals&&this.alwaysDisplayDecimals?value.toFixed(this.decimalPrecision):value;if(this.useThousandSeparator)
{if(this.useThousandSeparator&&Ext.isEmpty(this.thousandSeparator))
throw('NumberFormatException: invalid thousandSeparator, property must has a valid character.');if(this.thousandSeparator==this.decimalSeparator)
throw('NumberFormatException: invalid  thousandSeparator, thousand separator must be different from  decimalSeparator.');value=value.toString();var ps=value.split('.');ps[1]=ps[1]?ps[1]:null;var whole=ps[0];var r=/(\d+)(\d{3})/;var ts=this.thousandSeparator;while(r.test(whole))
whole=whole.replace(r,'$1'+ts+'$2');value=whole+(ps[1]?this.decimalSeparator+ps[1]:'');}
if(this.currencySymbolPos=='right'){return Ext.String.format('{0}{1}{2}',(neg?'-':''),value,(Ext.isEmpty(this.currencySymbol)?'':' '+this.currencySymbol));}else{return Ext.String.format('{0}{1}{2}',(neg?'-':''),(Ext.isEmpty(this.currencySymbol)?'':this.currencySymbol+'  '),value);}}},parseValue:function(value){return Ext.ux.form.NumericField.superclass.parseValue.call(this,this.removeFormat(value));},removeFormat:function(value){if(Ext.isEmpty(value)||!this.hasFormat())
return value;else
{if(this.currencySymbolPos=='right'){value=value.toString().replace(' '+this.currencySymbol,'');}else{value=value.toString().replace(this.currencySymbol+' ','');}
value=this.useThousandSeparator?value.replace(new RegExp('['+this.thousandSeparator+']','g'),''):value;return value;}},getErrors:function(value){return Ext.ux.form.NumericField.superclass.getErrors.call(this,this.removeFormat(value));},hasFormat:function(){return this.decimalSeparator!='.'||(this.useThousandSeparator==true&&this.getRawValue()!=null)||!Ext.isEmpty(this.currencySymbol)||this.alwaysDisplayDecimals;},onFocus:function(){this.setRawValue(this.removeFormat(this.getRawValue()));this.callParent(arguments);},processRawValue:function(value){return this.removeFormat(value);}});;Ext.define('BASE.ComboStatic',{extend:'Ext.form.field.ComboBox',fieldLabel:'Static combo',name:'combo_static',editable:false,allowBlank:false,triggerAction:'all',emptyText:'-- Select --',fields:['value','text'],store:[['value1','text1'],['value2','text2']],valueField:'value',displayField:'text',labelWidth:100,labelAlign:'right',width:300,constructor:function(config){return this.callParent(arguments);},initComponent:function(){return this.callParent(arguments);}});;Ext.define('BASE.ActionSingle',{extend:'BASE.Action',constructor:function(config){return this.callParent(arguments);},initComponent:function(){return this.callParent(arguments);},validate:function(source){this.validateSingle(source);}});;Ext.define('BASE.FormBasic',{extend:'Ext.form.Basic',constructor:function(config){return this.callParent(arguments);},initComponent:function(){var _this=this;return this.callParent(arguments);},getValues:function(asString,dirtyOnly,includeEmptyText,useDataValues){var values={},fields=this.getFields().items,f,fLen=fields.length,isArray=Ext.isArray,field,data,val,bucket,name;for(f=0;f<fLen;f++){field=fields[f];if(!dirtyOnly||field.isDirty()){data=field[useDataValues?'getModelData':'getSubmitData'](includeEmptyText);if(Ext.isObject(data)){for(name in data){if(data.hasOwnProperty(name)){val=data[name];if(includeEmptyText&&val===''){val=field.emptyText||'';}
if(values.hasOwnProperty(name)){bucket=values[name];if(!isArray(bucket)){bucket=values[name]=[bucket];}
if(isArray(val)){values[name]=bucket.concat(val);}else{bucket.push(val);}}else{values[name]=val;}}}}}}
if(typeof(this.mapping)=="function")
values=this.mapping(values);if(asString){values=Ext.Object.toQueryString(values);}
return values;},getInvalidFields:function(){var invalidFields=[];Ext.suspendLayouts();this.form.getFields().filterBy(function(field){if(field.validate())return;invalidFields.push(field);});Ext.resumeLayouts(true);return invalidFields;}});;Ext.define('BASE.ActionMultiple',{extend:'BASE.Action',constructor:function(config){return this.callParent(arguments);},initComponent:function(){return this.callParent(arguments);},validate:function(source){this.validateMultiple(source);}});;Ext.define('BASE.Toolbar',{extend:'Ext.toolbar.Toolbar',constructor:function(config){return this.callParent(arguments);},initComponent:function(){}});;Ext.define('BASE.Form',{extend:'Ext.form.Panel',constructor:function(config){Ext.apply(this,{bodyPadding:'10 0 0 5',border:false,defaults:{labelAlign:'right'}});return this.callParent(arguments);},initComponent:function(){var _this=this;return this.callParent(arguments);},createForm:function(){var cfg={},props=this.basicFormConfigs,len=props.length,i=0,prop;for(;i<len;++i){prop=props[i];cfg[prop]=this[prop];}
cfg=Ext.applyIf({listeners:{},mapping:this.mapping},cfg);return Ext.create('BASE.FormBasic',this,cfg);},getSaveUrl:function(){return MUST_IMPLEMENT('/'+((this.formAction=="add")?'AddUrl':'EditUrl'));},getLoadUrl:function(){return MUST_IMPLEMENT('LoadUrl');},getDeleteUrl:function(){return MUST_IMPLEMENT('DeleteUrl');},getSaveParams:function(){return this.formParams;},getLoadParams:function(){return this.formParams;},getDeleteParams:function(){return this.formParams;},submitData:function(arg){var _this=this;var opts={url:url,submitEmptyText:false,clientValidation:true,success:function(form,act){_this.fireEvent('afterSave',_this,act);},failure:_this.failureAlert,waitMsg:'Submit...',waitTitle:'Please wait...',params:_this.getSaveParams()};if(typeof(arg)=='object')
opts=Ext.apply(opts,arg);_this.form.submit(opts);},saveData:function(){var _this=this;var url=_this.getSaveUrl();_this.form.submit({url:url,submitEmptyText:false,clientValidation:true,success:function(form,act){_this.fireEvent('afterSave',_this,act);},failure:_this.failureAlert,waitMsg:'Saving...',waitTitle:'Please wait...',params:_this.getSaveParams()});},loadData:function(){var _this=this;var url=_this.getLoadUrl();_this.form.load({url:url,clientValidation:true,success:function(form,act){_this.fireEvent('afterLoad',_this,act);},failure:_this.failureAlert,waitMsg:'Loading...',waitTitle:'Please wait...',params:_this.getLoadParams()});},deleteData:function(){var _this=this;Ext.Msg.show({title:this.deleteQuestionTitle||"Warning",msg:this.deleteQuestionMsg||"Do you want to delete item(s) ?",icon:Ext.Msg.WARNING,buttons:Ext.Msg.YESNO,fn:function(bt){if(bt=="yes"){var url=_this.getDeleteUrl();_this.form.load({url:url,success:function(form,act){_this.fireEvent('afterDelete',_this,act);},failure:_this.failureAlert,waitMsg:'Deleting...',waitTitle:'Please wait...',params:_this.getDeleteParams()});}}});},failureAlert:function(form,action){var showError=function(title,msg){Ext.Msg.show({title:title,msg:msg,icon:Ext.Msg.ERROR,buttons:Ext.Msg.OK});};switch(action.failureType){case Ext.form.action.Action.CLIENT_INVALID:showError('Failure','Form fields may not be submitted with invalid values');break;case Ext.form.action.Action.CONNECT_FAILURE:showError('Failure','Ajax communication failed');break;case Ext.form.action.Action.SERVER_INVALID:var msg=action.result.message;showError('Failure',msg||action.response.responseText);break;}},reset:function(){this.form.reset();}});;Ext.define('BASE.Window',{extend:'Ext.window.Window',constructor:function(config){Ext.apply(this,{closeAction:'hide'});return this.callParent(arguments);},initComponent:function(){if(!this.minWidth)
this.minWidth=this.width;if(!this.minHeight)
this.minHeight=this.height;return this.callParent(arguments);},source:null,dialogParams:null,dialogAction:null,openDialog:function(title,action,sender,params,callback){this.source=sender;this.dialogParams=params;this.dialogAction=action;if(title)
this.setTitle(title);this.show(null,callback,this);}});